theory CircuitInterp
  imports Main "LogicCircuitTypes"
begin

definition ofan :: "('b \<Rightarrow> 'b \<Rightarrow> 'c) \<Rightarrow> ('a \<Rightarrow> 'b option) \<Rightarrow> 'a \<Rightarrow> 'a \<Rightarrow> 'c option" where
  "ofan op rc x y = 
  (case (rc x, rc y) of
    (Some x', Some y') \<Rightarrow> Some (op x' y') |
    _ \<Rightarrow> None)"

fun termInterp :: "Term \<Rightarrow> (PolynomialVariable \<rightharpoonup> Scalar) \<Rightarrow> Scalar option" where
"termInterp (Var x) mp = mp x" |

(*
  TODO: Implement this?
  Lookup
      "(Term InputExpression * LookupTableColumn) list"
      LookupTableOutputColumn |
*)
"termInterp (Lookup tbl cl) mp = None" |

"termInterp (Const x) mp = Some x" |
"termInterp (Plus x y) mp = 
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' + y') |
    _ \<Rightarrow> None)" |
"termInterp (Times x y) mp = 
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' * y') |
    _ \<Rightarrow> None)" |
"termInterp (Max x y) mp = 
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (max x' y') |
    _ \<Rightarrow> None)" |
"termInterp (IndLess x y) mp = 
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> 
      Some (if x' < y' then 1 else 0) |
    _ \<Rightarrow> None)"

fun ALCInterp :: "AtomicLogicConstraint \<Rightarrow> (PolynomialVariable \<rightharpoonup> Scalar) \<Rightarrow> bool option" where
"ALCInterp (Equals x y) mp =
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' = y') |
    _ \<Rightarrow> None)" |
"ALCInterp (LessThan x y) mp =
  (case (termInterp x mp, termInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' < y') |
    _ \<Rightarrow> None)"

fun LCInterp :: "LogicConstraint \<Rightarrow> (PolynomialVariable \<rightharpoonup> Scalar) \<Rightarrow> bool option" where
"LCInterp (Atom x) mp = ALCInterp x mp" |
"LCInterp (Not x) mp = 
  (case LCInterp x mp of
    Some x' \<Rightarrow> Some (\<not> x') |
    _ \<Rightarrow> None)" |
"LCInterp (And x y) mp = 
  (case (LCInterp x mp, LCInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' & y') |
    _ \<Rightarrow> None)" |
"LCInterp (Or x y) mp = 
  (case (LCInterp x mp, LCInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' | y') |
    _ \<Rightarrow> None)" |
"LCInterp (Iff x y) mp = 
  (case (LCInterp x mp, LCInterp y mp) of
    (Some x', Some y') \<Rightarrow> Some (x' \<longleftrightarrow> y') |
    _ \<Rightarrow> None)" |
"LCInterp Top mp = Some True" |
"LCInterp Bottom mp = Some False"



end